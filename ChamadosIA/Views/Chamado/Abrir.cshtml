@model ChamadosIA.Models.Chamado
@{
    ViewData["Title"] = "Abrir Chamado";
}

<link rel="stylesheet" href="~/css/site.css" />

<style>
    .form-container {
        max-width: 700px;
        margin: 60px auto;
        background: linear-gradient(to right, #6dd5ed, #2193b0);
        border-radius: 12px;
        padding: 40px;
        color: white;
        box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }

    .form-container h2 {
        text-align: center;
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .form-container h4 {
        text-align: center;
        font-weight: 400;
        margin-bottom: 30px;
        opacity: 0.9;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-control {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: none;
        font-size: 1rem;
    }

    .btn-submit {
        background-color: #00c6ff;
        color: white;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        font-size: 1rem;
        transition: background 0.3s ease;
        text-align: center;
        text-decoration: none;
        width: 100%;
    }

    .btn-submit:hover {
        background-color: #007acc;
    }

    footer {
        margin-top: 30px;
        text-align: center;
        font-size: 0.85rem;
        color: #eee;
    }
</style>

<div class="form-container">
    <h2>üì® Abrir Chamado</h2>
    <h4>Classifique o servi√ßo e descreva o problema</h4>

    <form asp-action="Abrir" method="post">
        <div class="form-group">
            <label for="Servico">Servi√ßo</label>
            <select id="Servico" name="Servico" class="form-control" onchange="atualizarCategorias()">
                <option value="">Selecione...</option>
                <option value="Hardware">üñ•Ô∏ù Hardware</option>
                <option value="Software">üß† Software</option>
                <option value="Redes">üåù Redes</option>
                <option value="Telefonia">‚òéÔ∏ù Telefonia</option>
            </select>
        </div>

        <div class="form-group">
            <label for="Categoria">Categoria</label>
            <select id="Categoria" name="Categoria" class="form-control" onchange="atualizarSubcategorias()">
                <option value="">Selecione um servi√ßo primeiro</option>
            </select>
        </div>

        <div class="form-group">
            <label for="Subcategoria">Subcategoria</label>
            <select id="Subcategoria" name="Subcategoria" class="form-control" onchange="atualizarTitulo()">
                <option value="">Selecione uma categoria primeiro</option>
            </select>
        </div>

        <div class="form-group">
            <label for="Titulo">T√≠tulo do Chamado</label>
            <input id="Titulo" name="Titulo" class="form-control" readonly />
        </div>

        <div class="form-group">
            <label for="Descricao">Descri√ß√£o do problema</label>
            <textarea id="Descricao" name="Descricao" class="form-control" rows="5" placeholder="Descreva o problema com detalhes..."></textarea>
        </div>

        <h4 style="margin-top:40px;">üìç Endere√ßo do Local do Problema</h4>

<div class="form-group">
    <label for="Cep">CEP</label>
    <input type="text" id="Cep" name="Cep" class="form-control" maxlength="9" placeholder="Ex: 01001-000" onblur="buscarEndereco()" />
</div>

<div class="form-group">
    <label for="Rua">Rua</label>
    <input type="text" id="Rua" name="Rua" class="form-control" readonly />
</div>

<div class="form-group">
    <label for="Bairro">Bairro</label>
    <input type="text" id="Bairro" name="Bairro" class="form-control" readonly />
</div>

<div class="form-group">
    <label for="Cidade">Cidade</label>
    <input type="text" id="Cidade" name="Cidade" class="form-control" readonly />
</div>

<div class="form-group">
    <label for="UF">Estado (UF)</label>
    <input type="text" id="UF" name="UF" class="form-control" readonly />
</div>

<div class="form-group">
    <label for="Numero">N√∫mero</label>
    <input type="text" id="Numero" name="Numero" class="form-control" placeholder="Ex: 123" />
</div>

<div class="form-group">
    <label for="Referencia">Refer√™ncia</label>
    <input type="text" id="Referencia" name="Referencia" class="form-control" placeholder="Ex: Pr√≥ximo ao port√£o azul" />
</div>





        <button type="submit" class="btn-submit">üì§ Enviar Chamado</button>
    </form>

    <footer>
        Este site √© seguro e foi desenvolvido pela equipe do CATI.
    </footer>

    <div id="faqSugestao" style="display:none; margin-top:20px;">
    <h4>üîß Sugest√£o para resolver o problema:</h4>
    <p id="faqTexto" style="margin-bottom:15px;"></p>
    <p>Essa sugest√£o resolveu seu problema?</p>
    <button onclick="faqResolvido(true)" class="btn-submit" style="background-color:#28a745;">‚úÖ Sim, resolvido</button>
    <button onclick="faqResolvido(false)" class="btn-submit" style="background-color:#dc3545;">‚ùå N√£o, continuar com chamado</button>
</div>
</div>

<script>
    const categorias = {
        "Hardware": ["Desktop", "Notebook", "Impressora"],
        "Software": ["Sistema", "Aplicativo", "Atualiza√ß√£o"],
        "Redes": ["Wi-Fi", "Cabo", "VPN"],
        "Telefonia": ["Ramal", "Chamada", "Configura√ß√£o"]
    };

    const subcategorias = {
        "Desktop": ["Configura√ß√£o", "Sem imagem", "Lento"],
        "Notebook": ["Bateria", "Tela quebrada", "Teclado"],
        "Impressora": ["Sem papel", "Erro de impress√£o", "Conex√£o falha"],
        "Sistema": ["Erro de login", "Permiss√£o", "Tela travada"],
        "Aplicativo": ["N√£o abre", "Erro ao salvar", "Atualiza√ß√£o"],
        "Atualiza√ß√£o": ["Falha", "Vers√£o incompat√≠vel"],
        "Wi-Fi": ["Sem conex√£o", "Sinal fraco", "Queda constante"],
        "Cabo": ["Sem sinal", "Porta danificada"],
        "VPN": ["Instabilidade", "N√£o conecta"],
        "Ramal": ["Mudo", "Sem linha", "Chamada externa"],
        "Chamada": ["Interrup√ß√£o", "Eco", "Ru√≠do"],
        "Configura√ß√£o": ["Desvio de chamadas", "Toque personalizado"]
    };

    function atualizarCategorias() {
        const servico = document.getElementById("Servico").value;
        const categoria = document.getElementById("Categoria");
        const subcategoria = document.getElementById("Subcategoria");
        categoria.innerHTML = "";
        subcategoria.innerHTML = "<option value=''>Selecione uma categoria primeiro</option>";
        document.getElementById("Titulo").value = "";

        if (categorias[servico]) {
            categorias[servico].forEach(function (item) {
                const opt = document.createElement("option");
                opt.value = item;
                opt.innerHTML = item;
                categoria.appendChild(opt);
            });
        } else {
            const opt = document.createElement("option");
            opt.value = "";
            opt.innerHTML = "Selecione um servi√ßo primeiro";
            categoria.appendChild(opt);
        }
    }

    function atualizarSubcategorias() {
        const categoria = document.getElementById("Categoria").value;
        const subcategoria = document.getElementById("Subcategoria");
        subcategoria.innerHTML = "";
        document.getElementById("Titulo").value = "";

        if (subcategorias[categoria]) {
            subcategorias[categoria].forEach(function (item) {
                const opt = document.createElement("option");
                opt.value = item;
                opt.innerHTML = item;
                subcategoria.appendChild(opt);
            });
        } else {
            const opt = document.createElement("option");
            opt.value = "";
            opt.innerHTML = "Selecione uma categoria primeiro";
            subcategoria.appendChild(opt);
        }
    }

    function atualizarTitulo() {
        const servico = document.getElementById("Servico").value;
        const categoria = document.getElementById("Categoria").value;
        const subcategoria = document.getElementById("Subcategoria").value;

        if (servico && categoria && subcategoria) {
            document.getElementById("Titulo").value = `${servico} - ${categoria} - ${subcategoria}`;
        } else {
            document.getElementById("Titulo").value = "";
        }
    }

const faq = {
    "Redes|Wi-Fi|Queda constante": "Desligue o modem da tomada, aguarde 15 segundos e ligue novamente.",
    "Telefonia|Ramal|Mudo": "Verifique se o cabo do telefone est√° bem conectado e se h√° sinal no aparelho.",
    "Hardware|Desktop|Lento": "Reinicie o computador e feche programas em segundo plano.",
    "Software|Sistema|Erro de login": "Verifique se o CAPS LOCK est√° ativado e tente redefinir sua senha."
};

function atualizarTitulo() {
    const servico = document.getElementById("Servico").value;
    const categoria = document.getElementById("Categoria").value;
    const subcategoria = document.getElementById("Subcategoria").value;
    const titulo = `${servico} - ${categoria} - ${subcategoria}`;
    document.getElementById("Titulo").value = titulo;

    const chave = `${servico}|${categoria}|${subcategoria}`;
    if (faq[chave]) {
        document.getElementById("faqTexto").innerText = faq[chave];
        document.getElementById("faqSugestao").style.display = "block";
        document.querySelector("form").style.display = "none";
    } else {
        document.getElementById("faqSugestao").style.display = "none";
        document.querySelector("form").style.display = "block";
    }
}

function faqResolvido(resolvido) {
    if (resolvido) {
        window.location.href = "/Cliente/Dashboard"; // ou /Tecnico/Dashboard
    } else {
        document.getElementById("faqSugestao").style.display = "none";
        document.querySelector("form").style.display = "block";
    }
}

function buscarEndereco() {
    const cep = document.getElementById("Cep").value.replace(/\D/g, '');
    if (cep.length !== 8) return;

    fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(response => response.json())
        .then(data => {
            if (!data.erro) {
                document.getElementById("Rua").value = data.logradouro;
                document.getElementById("Bairro").value = data.bairro;
                document.getElementById("Cidade").value = data.localidade;
                document.getElementById("UF").value = data.uf;
            } else {
                alert("CEP n√£o encontrado.");
            }
        })
        .catch(() => alert("Erro ao consultar o CEP."));
}

</script>